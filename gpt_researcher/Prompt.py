import warnings
from datetime import date, datetime, timezone

from .utils.enum import ReportSource, ReportType, Tone
from typing import List, Dict, Any


def generate_search_queries_prompt(
    question: str,
    parent_query: str,
    report_type: str,
    max_iterations: int = 3,
    context: List[Dict[str, Any]] = [],
):
    """ç”Ÿæˆç»™å®šé—®é¢˜çš„æœç´¢æŸ¥è¯¢æç¤ºã€‚
    å‚æ•°:
        question (str): è¦ç”Ÿæˆæœç´¢æŸ¥è¯¢æç¤ºçš„é—®é¢˜
        parent_query (str): ä¸»è¦é—®é¢˜ï¼ˆä»…ä¸è¯¦ç»†æŠ¥å‘Šç›¸å…³ï¼‰
        report_type (str): æŠ¥å‘Šç±»å‹
        max_iterations (int): è¦ç”Ÿæˆçš„æœç´¢æŸ¥è¯¢çš„æœ€å¤§æ•°é‡
        context (str): é€šè¿‡å®æ—¶ç½‘ç»œä¿¡æ¯æ›´å¥½åœ°ç†è§£ä»»åŠ¡çš„ä¸Šä¸‹æ–‡

    è¿”å›: str: ç»™å®šé—®é¢˜çš„æœç´¢æŸ¥è¯¢æç¤º
    """

    if (
        report_type == ReportType.DetailedReport.value
        or report_type == ReportType.SubtopicReport.value
    ):
        task = f"{parent_query} - {question}"
    else:
        task = question

    context_prompt = f"""
ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç ”ç©¶åŠ©æ‰‹ï¼Œè´Ÿè´£ç”Ÿæˆæœç´¢æŸ¥è¯¢ä»¥æ‰¾åˆ°ä¸ä»¥ä¸‹ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯ï¼š"{task}"ã€‚
ä¸Šä¸‹æ–‡ï¼š{context}

ä½¿ç”¨æ­¤ä¸Šä¸‹æ–‡æ¥æŒ‡å¯¼å’Œå®Œå–„ä½ çš„æœç´¢æŸ¥è¯¢ã€‚ä¸Šä¸‹æ–‡æä¾›äº†å®æ—¶ç½‘ç»œä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©ä½ ç”Ÿæˆæ›´å…·ä½“å’Œç›¸å…³çš„æŸ¥è¯¢ã€‚è€ƒè™‘ä¸Šä¸‹æ–‡ä¸­æåˆ°çš„ä»»ä½•å½“å‰äº‹ä»¶ã€æœ€æ–°å‘å±•æˆ–ç‰¹å®šç»†èŠ‚ï¼Œè¿™äº›éƒ½å¯ä»¥å¢å¼ºæœç´¢æŸ¥è¯¢ã€‚
""" if context else ""

    dynamic_example = ", ".join([f'"æŸ¥è¯¢ {i+1}"' for i in range(max_iterations)])

    return f"""ç¼–å†™{max_iterations}ä¸ªè°·æ­Œæœç´¢æŸ¥è¯¢ï¼Œä»¥ä¾¿åœ¨çº¿æœç´¢ï¼Œä»ä»¥ä¸‹ä»»åŠ¡ä¸­å½¢æˆå®¢è§‚æ„è§ï¼š"{task}"

å¦‚æœéœ€è¦ï¼Œå‡è®¾å½“å‰æ—¥æœŸæ˜¯{datetime.now(timezone.utc).strftime('%B %d, %Y')}ã€‚

{context_prompt}
ä½ å¿…é¡»ä»¥ä»¥ä¸‹æ ¼å¼å›å¤å­—ç¬¦ä¸²åˆ—è¡¨ï¼š[{dynamic_example}]ã€‚
å›å¤åº”è¯¥åªåŒ…å«åˆ—è¡¨ã€‚
"""


def generate_report_prompt(
    question: str,
    context,
    report_source: str,
    report_format="apa",
    total_words=1000,
    tone=None,
    language="english",
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”ŸæˆæŠ¥å‘Šæç¤ºã€‚
    å‚æ•°: question (str): è¦ç”ŸæˆæŠ¥å‘Šæç¤ºçš„é—®é¢˜
            research_summary (str): è¦ç”ŸæˆæŠ¥å‘Šæç¤ºçš„ç ”ç©¶æ‘˜è¦
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„æŠ¥å‘Šæç¤º
    """

    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å°†æ‰€æœ‰ä½¿ç”¨çš„æºURLä½œä¸ºå‚è€ƒåˆ—å‡ºï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æ¥æºï¼Œè€Œåªä¸ºæ¯ä¸ªæ¥æºæ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚
æ¯ä¸ªURLåº”è¯¥æ˜¯è¶…é“¾æ¥ï¼š[ç½‘ç«™URL](URL)
æ­¤å¤–ï¼Œä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³URLçš„åœ°æ–¹åŒ…å«è¶…é“¾æ¥ï¼š

ä¾‹å¦‚ï¼šä½œè€…ï¼ŒA. A.ï¼ˆå¹´ï¼Œæœˆï¼Œæ—¥ï¼‰ã€‚ç½‘é¡µæ ‡é¢˜ã€‚ç½‘ç«™åç§°ã€‚[ç½‘ç«™URL](URL)
"""
    else:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å°†æ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒåˆ—å‡ºï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æ¥æºï¼Œè€Œåªä¸ºæ¯ä¸ªæ¥æºæ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚"
"""

    tone_prompt = f"ä»¥{tone.value}çš„è¯­æ°”æ’°å†™æŠ¥å‘Šã€‚" if tone else ""

    return f"""
ä¿¡æ¯ï¼š"{context}"
---
ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯ï¼Œä»¥è¯¦ç»†æŠ¥å‘Šçš„å½¢å¼å›ç­”ä»¥ä¸‹æŸ¥è¯¢æˆ–ä»»åŠ¡ï¼š"{question}" --
æŠ¥å‘Šåº”è¯¥ä¸“æ³¨äºå›ç­”æŸ¥è¯¢ï¼Œç»“æ„è‰¯å¥½ï¼Œä¿¡æ¯ä¸°å¯Œï¼Œ
æ·±å…¥ä¸”å…¨é¢ï¼Œå¦‚æœæœ‰å¯ç”¨çš„äº‹å®å’Œæ•°å­—ï¼Œåº”åŒ…å«è¿™äº›å†…å®¹ï¼Œå¹¶ä¸”è‡³å°‘æœ‰{total_words}ä¸ªå­—ã€‚
ä½ åº”è¯¥åŠªåŠ›ä½¿ç”¨æ‰€æœ‰æä¾›çš„ç›¸å…³å’Œå¿…è¦ä¿¡æ¯ï¼Œå°½å¯èƒ½åœ°å†™é•¿æŠ¥å‘Šã€‚

è¯·åœ¨ä½ çš„æŠ¥å‘Šä¸­éµå¾ªä»¥ä¸‹æ‰€æœ‰æŒ‡å¯¼æ–¹é’ˆï¼š
- ä½ å¿…é¡»æ ¹æ®ç»™å®šä¿¡æ¯ç¡®å®šè‡ªå·±å…·ä½“ä¸”æœ‰æ•ˆçš„è§‚ç‚¹ã€‚ä¸è¦æ¨è¿Ÿåˆ°ä¸€èˆ¬å’Œæ— æ„ä¹‰çš„ç»“è®ºã€‚
- ä½ å¿…é¡»ä½¿ç”¨markdownè¯­æ³•å’Œ{report_format}æ ¼å¼ç¼–å†™æŠ¥å‘Šã€‚
- ä½ å¿…é¡»ä¼˜å…ˆè€ƒè™‘ä½ ä½¿ç”¨çš„æ¥æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚é€‰æ‹©å¯ä¿¡æ¥æºè€Œéä¸å¤ªå¯é çš„æ¥æºã€‚
- å¦‚æœæ¥æºå¯ä¿¡ï¼Œä½ ä¹Ÿå¿…é¡»ä¼˜å…ˆè€ƒè™‘æ–°æ–‡ç« è€Œéæ—§æ–‡ç« ã€‚
- ä½¿ç”¨{report_format}æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒï¼Œå¹¶åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½ç»“å°¾å¤„ä½¿ç”¨markdownè¶…é“¾æ¥ï¼Œå¦‚ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
- ä¸è¦å¿˜è®°åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ {report_format}æ ¼å¼çš„å‚è€ƒåˆ—è¡¨å’Œå®Œæ•´çš„urlé“¾æ¥ï¼Œä¸å¸¦è¶…é“¾æ¥ã€‚
- {reference_prompt}
- {tone_prompt}

ä½ å¿…é¡»ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚
è¯·å°½åŠ›è€Œä¸ºï¼Œè¿™å¯¹æˆ‘çš„èŒä¸šç”Ÿæ¶¯éå¸¸é‡è¦ã€‚
å‡è®¾å½“å‰æ—¥æœŸæ˜¯{date.today()}ã€‚
"""

def curate_sources(query, sources, max_results=10):
    return f"""ä½ çš„ç›®æ ‡æ˜¯è¯„ä¼°å’Œæ•´ç†ä¸ºç ”ç©¶ä»»åŠ¡æä¾›çš„æŠ“å–å†…å®¹ï¼š"{query}"ï¼Œ
    åŒæ—¶ä¼˜å…ˆåŒ…å«ç›¸å…³å’Œé«˜è´¨é‡çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯åŒ…å«ç»Ÿè®¡æ•°æ®ã€æ•°å­—æˆ–å…·ä½“æ•°æ®çš„æ¥æºã€‚

æœ€ç»ˆæ•´ç†çš„åˆ—è¡¨å°†ç”¨ä½œåˆ›å»ºç ”ç©¶æŠ¥å‘Šçš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä¼˜å…ˆè€ƒè™‘ï¼š
- å°½å¯èƒ½ä¿ç•™åŸå§‹ä¿¡æ¯ï¼Œç‰¹åˆ«å¼ºè°ƒåŒ…å«å®šé‡æ•°æ®æˆ–ç‹¬ç‰¹è§è§£çš„æ¥æº
- åŒ…å«å¹¿æ³›çš„è§‚ç‚¹å’Œè§è§£
- ä»…è¿‡æ»¤æ‰æ˜æ˜¾ä¸ç›¸å…³æˆ–æ— æ³•ä½¿ç”¨çš„å†…å®¹

è¯„ä¼°æŒ‡å—ï¼š
1. æ ¹æ®ä»¥ä¸‹æ ‡å‡†è¯„ä¼°æ¯ä¸ªæ¥æºï¼š
   - ç›¸å…³æ€§ï¼šåŒ…æ‹¬ç›´æ¥æˆ–éƒ¨åˆ†ä¸ç ”ç©¶æŸ¥è¯¢ç›¸å…³çš„æ¥æºã€‚å€¾å‘äºåŒ…å«è€Œéæ’é™¤ã€‚
   - å¯ä¿¡åº¦ï¼šä¼˜å…ˆè€ƒè™‘æƒå¨æ¥æºï¼Œä½†ä¿ç•™å…¶ä»–æ¥æºï¼Œé™¤éæ˜æ˜¾ä¸å¯ä¿¡ã€‚
   - æ—¶æ•ˆæ€§ï¼šä¼˜å…ˆè€ƒè™‘æœ€æ–°ä¿¡æ¯ï¼Œé™¤éæ—§æ•°æ®æ˜¯å¿…è¦æˆ–æœ‰ä»·å€¼çš„ã€‚
   - å®¢è§‚æ€§ï¼šä¿ç•™æœ‰åè§çš„æ¥æºï¼Œå¦‚æœå®ƒä»¬æä¾›ç‹¬ç‰¹æˆ–äº’è¡¥çš„è§‚ç‚¹ã€‚
   - å®šé‡ä»·å€¼ï¼šä¼˜å…ˆè€ƒè™‘åŒ…å«ç»Ÿè®¡æ•°æ®ã€æ•°å­—æˆ–å…¶ä»–å…·ä½“æ•°æ®çš„æ¥æºã€‚
2. æ¥æºé€‰æ‹©ï¼š
   - å°½å¯èƒ½åŒ…å«å¤šä¸ªç›¸å…³æ¥æºï¼Œæœ€å¤š{max_results}ä¸ªï¼Œæ³¨é‡å¹¿æ³›è¦†ç›–å’Œå¤šæ ·æ€§ã€‚
   - ä¼˜å…ˆè€ƒè™‘åŒ…å«ç»Ÿè®¡æ•°æ®ã€æ•°å€¼æ•°æ®æˆ–å¯éªŒè¯äº‹å®çš„æ¥æºã€‚
   - å¦‚æœé‡å å†…å®¹å¢åŠ æ·±åº¦ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠæ•°æ®æ—¶ï¼Œå¯ä»¥æ¥å—ã€‚
   - ä»…å½“æ¥æºå®Œå…¨ä¸ç›¸å…³ã€ä¸¥é‡è¿‡æ—¶æˆ–ç”±äºå†…å®¹è´¨é‡å·®è€Œæ— æ³•ä½¿ç”¨æ—¶æ‰æ’é™¤ã€‚
3. å†…å®¹ä¿ç•™ï¼š
   - ä¸è¦é‡å†™ã€æ€»ç»“æˆ–å‹ç¼©ä»»ä½•æ¥æºå†…å®¹ã€‚
   - ä¿ç•™æ‰€æœ‰å¯ç”¨ä¿¡æ¯ï¼Œåªæ¸…ç†æ˜æ˜¾çš„åƒåœ¾æˆ–æ ¼å¼é—®é¢˜ã€‚
   - å¦‚æœè¾¹ç¼˜ç›¸å…³æˆ–ä¸å®Œæ•´çš„æ¥æºåŒ…å«æœ‰ä»·å€¼çš„æ•°æ®æˆ–è§è§£ï¼Œåˆ™ä¿ç•™å®ƒä»¬ã€‚

è¦è¯„ä¼°çš„æ¥æºåˆ—è¡¨ï¼š
{sources}

ä½ å¿…é¡»ä»¥ä¸åŸå§‹æ¥æºå®Œå…¨ç›¸åŒçš„JSONåˆ—è¡¨æ ¼å¼è¿”å›ä½ çš„å“åº”ã€‚
å“åº”ä¸å¾—åŒ…å«ä»»ä½•markdownæ ¼å¼æˆ–é¢å¤–æ–‡æœ¬ï¼ˆå¦‚```jsonï¼‰ï¼Œåªæœ‰JSONåˆ—è¡¨ï¼
"""




def generate_resource_report_prompt(
    question, context, report_source: str, report_format="apa", tone=None, total_words=1000, language="english"
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºã€‚

    å‚æ•°:
        question (str): è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºçš„é—®é¢˜ã€‚
        context (str): è¦ç”Ÿæˆèµ„æºæŠ¥å‘Šæç¤ºçš„ç ”ç©¶æ‘˜è¦ã€‚

    è¿”å›:
        str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„èµ„æºæŠ¥å‘Šæç¤ºã€‚
    """

    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
            ä½ å¿…é¡»åŒ…å«æ‰€æœ‰ç›¸å…³çš„æºURLã€‚
            æ¯ä¸ªURLåº”è¯¥æ˜¯è¶…é“¾æ¥ï¼š[ç½‘ç«™URL](URL)
            """
    else:
        reference_prompt = f"""
            ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å°†æ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒåˆ—å‡ºï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æ¥æºï¼Œè€Œåªä¸ºæ¯ä¸ªæ¥æºæ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚"
        """

    return (
        f'"""{context}"""\n\nåŸºäºä¸Šè¿°ä¿¡æ¯ï¼Œä¸ºä»¥ä¸‹é—®é¢˜æˆ–ä¸»é¢˜ç”Ÿæˆä¸€ä»½å‚è€ƒä¹¦ç›®æ¨èæŠ¥å‘Šï¼š'
        f'"{question}"ã€‚æŠ¥å‘Šåº”æä¾›æ¯ä¸ªæ¨èèµ„æºçš„è¯¦ç»†åˆ†æï¼Œ'
        "è§£é‡Šæ¯ä¸ªæ¥æºå¦‚ä½•æœ‰åŠ©äºæ‰¾åˆ°ç ”ç©¶é—®é¢˜çš„ç­”æ¡ˆã€‚\n"
        "å…³æ³¨æ¯ä¸ªæ¥æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚\n"
        "ç¡®ä¿æŠ¥å‘Šç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥ä¸”éµå¾ªMarkdownè¯­æ³•ã€‚\n"
        "åœ¨å¯ç”¨æ—¶åŒ…å«ç›¸å…³äº‹å®ã€æ•°æ®å’Œæ•°å­—ã€‚\n"
        f"æŠ¥å‘Šåº”è‡³å°‘æœ‰{total_words}ä¸ªå­—ã€‚\n"
        f"ä½ å¿…é¡»ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚\n"
        "ä½ å¿…é¡»åŒ…å«æ‰€æœ‰ç›¸å…³çš„æºURLã€‚"
        "æ¯ä¸ªURLåº”è¯¥æ˜¯è¶…é“¾æ¥ï¼š[ç½‘ç«™URL](URL)"
        f"{reference_prompt}"
    )


def generate_custom_report_prompt(
    query_prompt, context, report_source: str, report_format="apa", tone=None, total_words=1000, language: str = "english"
):
    return f'"{context}"\n\n{query_prompt}'


def generate_outline_report_prompt(
    question, context, report_source: str, report_format="apa", tone=None,  total_words=1000, language: str = "english"
):
    """ä¸ºç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºã€‚
    å‚æ•°: question (str): è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºçš„é—®é¢˜
            research_summary (str): è¦ç”Ÿæˆå¤§çº²æŠ¥å‘Šæç¤ºçš„ç ”ç©¶æ‘˜è¦
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œç ”ç©¶æ‘˜è¦çš„å¤§çº²æŠ¥å‘Šæç¤º
    """

    return (
        f'"""{context}""" ä½¿ç”¨ä¸Šè¿°ä¿¡æ¯ï¼Œä¸ºä»¥ä¸‹é—®é¢˜æˆ–ä¸»é¢˜ç”Ÿæˆä¸€ä»½Markdownè¯­æ³•çš„ç ”ç©¶æŠ¥å‘Šå¤§çº²ï¼š'
        f'"{question}"ã€‚å¤§çº²åº”ä¸ºç ”ç©¶æŠ¥å‘Šæä¾›ä¸€ä¸ªç»“æ„è‰¯å¥½çš„æ¡†æ¶ï¼Œ'
        "åŒ…æ‹¬ä¸»è¦éƒ¨åˆ†ã€å­éƒ¨åˆ†å’Œè¦æ¶µç›–çš„å…³é”®ç‚¹ã€‚"
        f"ç ”ç©¶æŠ¥å‘Šåº”è¯¦ç»†ã€ä¿¡æ¯ä¸°å¯Œã€æ·±å…¥ä¸”è‡³å°‘æœ‰{total_words}ä¸ªå­—ã€‚"
        "ä½¿ç”¨é€‚å½“çš„Markdownè¯­æ³•æ ¼å¼åŒ–å¤§çº²å¹¶ç¡®ä¿å¯è¯»æ€§ã€‚"
    )


def generate_deep_research_prompt(
    question: str,
    context: str,
    report_source: str,
    report_format="apa",
    tone=None,
    total_words=2000,
    language: str = "english"
):
    """ç”Ÿæˆæ·±åº¦ç ”ç©¶æŠ¥å‘Šæç¤ºï¼Œä¸“é—¨ç”¨äºå¤„ç†å±‚æ¬¡åŒ–ç ”ç©¶ç»“æœã€‚
    å‚æ•°:
        question (str): ç ”ç©¶é—®é¢˜
        context (str): åŒ…å«å¸¦å¼•ç”¨çš„å­¦ä¹ å†…å®¹çš„ç ”ç©¶ä¸Šä¸‹æ–‡
        report_source (str): ç ”ç©¶æ¥æºï¼ˆç½‘ç»œç­‰ï¼‰
        report_format (str): æŠ¥å‘Šæ ¼å¼æ ·å¼
        tone: å†™ä½œæ—¶ä½¿ç”¨çš„è¯­æ°”
        total_words (int): æœ€å°å­—æ•°
        language (str): è¾“å‡ºè¯­è¨€
    è¿”å›:
        str: æ·±åº¦ç ”ç©¶æŠ¥å‘Šæç¤º
    """
    reference_prompt = ""
    if report_source == ReportSource.Web.value:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å°†æ‰€æœ‰ä½¿ç”¨çš„æºURLä½œä¸ºå‚è€ƒåˆ—å‡ºï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æ¥æºï¼Œè€Œåªä¸ºæ¯ä¸ªæ¥æºæ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚
æ¯ä¸ªURLåº”è¯¥æ˜¯è¶…é“¾æ¥ï¼š[ç½‘ç«™URL](URL)
æ­¤å¤–ï¼Œä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³URLçš„åœ°æ–¹åŒ…å«è¶…é“¾æ¥ï¼š

ä¾‹å¦‚ï¼šä½œè€…ï¼ŒA. A.ï¼ˆå¹´ï¼Œæœˆï¼Œæ—¥ï¼‰ã€‚ç½‘é¡µæ ‡é¢˜ã€‚ç½‘ç«™åç§°ã€‚[ç½‘ç«™URL](URL)
"""
    else:
        reference_prompt = f"""
ä½ å¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾å°†æ‰€æœ‰ä½¿ç”¨çš„æºæ–‡æ¡£åç§°ä½œä¸ºå‚è€ƒåˆ—å‡ºï¼Œå¹¶ç¡®ä¿ä¸æ·»åŠ é‡å¤çš„æ¥æºï¼Œè€Œåªä¸ºæ¯ä¸ªæ¥æºæ·»åŠ ä¸€ä¸ªå¼•ç”¨ã€‚"
"""

    tone_prompt = f"ä»¥{tone.value}çš„è¯­æ°”æ’°å†™æŠ¥å‘Šã€‚" if tone else ""
    
    return f"""
ä½¿ç”¨ä»¥ä¸‹å±‚æ¬¡åŒ–ç ”ç©¶ä¿¡æ¯å’Œå¼•ç”¨ï¼š

"{context}"

æ’°å†™ä¸€ä»½å…¨é¢çš„ç ”ç©¶æŠ¥å‘Šï¼Œå›ç­”æŸ¥è¯¢ï¼š"{question}"

æŠ¥å‘Šåº”ï¼š
1. ç»¼åˆå¤šå±‚æ¬¡ç ”ç©¶æ·±åº¦çš„ä¿¡æ¯
2. æ•´åˆæ¥è‡ªå„ç§ç ”ç©¶åˆ†æ”¯çš„å‘ç°
3. å‘ˆç°ä¸€ä¸ªä»åŸºç¡€åˆ°é«˜çº§è§è§£æ„å»ºçš„è¿è´¯å™è¿°
4. åœ¨æ•´ä¸ªæŠ¥å‘Šä¸­ä¿æŒé€‚å½“çš„æ¥æºå¼•ç”¨
5. ç»“æ„è‰¯å¥½ï¼Œæœ‰æ¸…æ™°çš„ç« èŠ‚å’Œå°èŠ‚
6. è‡³å°‘æœ‰{total_words}ä¸ªå­—
7. éµå¾ª{report_format}æ ¼å¼ï¼Œä½¿ç”¨markdownè¯­æ³•

é¢å¤–è¦æ±‚ï¼š
- ä¼˜å…ˆè€ƒè™‘ä»æ›´æ·±å±‚æ¬¡ç ”ç©¶ä¸­å‡ºç°çš„è§è§£
- çªå‡ºä¸åŒç ”ç©¶åˆ†æ”¯ä¹‹é—´çš„è”ç³»
- åŒ…å«ç›¸å…³ç»Ÿè®¡æ•°æ®ã€æ•°æ®å’Œå…·ä½“ä¾‹å­
- ä½ å¿…é¡»æ ¹æ®ç»™å®šä¿¡æ¯ç¡®å®šè‡ªå·±å…·ä½“ä¸”æœ‰æ•ˆçš„è§‚ç‚¹ã€‚ä¸è¦æ¨è¿Ÿåˆ°ä¸€èˆ¬å’Œæ— æ„ä¹‰çš„ç»“è®ºã€‚
- ä½ å¿…é¡»ä¼˜å…ˆè€ƒè™‘ä½ ä½¿ç”¨çš„æ¥æºçš„ç›¸å…³æ€§ã€å¯é æ€§å’Œé‡è¦æ€§ã€‚é€‰æ‹©å¯ä¿¡æ¥æºè€Œéä¸å¤ªå¯é çš„æ¥æºã€‚
- å¦‚æœæ¥æºå¯ä¿¡ï¼Œä½ ä¹Ÿå¿…é¡»ä¼˜å…ˆè€ƒè™‘æ–°æ–‡ç« è€Œéæ—§æ–‡ç« ã€‚
- ä½¿ç”¨{report_format}æ ¼å¼çš„æ–‡å†…å¼•ç”¨å‚è€ƒï¼Œå¹¶åœ¨å¼•ç”¨å®ƒä»¬çš„å¥å­æˆ–æ®µè½ç»“å°¾å¤„ä½¿ç”¨markdownè¶…é“¾æ¥ï¼Œå¦‚ï¼š([æ–‡å†…å¼•ç”¨](url))ã€‚
- {tone_prompt}
- ç”¨{language}è¯­è¨€æ’°å†™

{reference_prompt}

è¯·æ’°å†™ä¸€ä»½å½»åº•ã€ç ”ç©¶å……åˆ†çš„æŠ¥å‘Šï¼Œå°†æ‰€æœ‰æ”¶é›†çš„ä¿¡æ¯ç»¼åˆæˆä¸€ä¸ªè¿è´¯çš„æ•´ä½“ã€‚
å‡è®¾å½“å‰æ—¥æœŸæ˜¯{datetime.now(timezone.utc).strftime('%B %d, %Y')}ã€‚
"""


def auto_agent_instructions():
    return """
è¿™é¡¹ä»»åŠ¡æ¶‰åŠç ”ç©¶ç»™å®šä¸»é¢˜ï¼Œæ— è®ºå…¶å¤æ‚æ€§æˆ–æ˜¯å¦æœ‰æ˜ç¡®ç­”æ¡ˆã€‚ç ”ç©¶ç”±ç‰¹å®šæœåŠ¡å™¨è¿›è¡Œï¼Œç”±å…¶ç±»å‹å’Œè§’è‰²å®šä¹‰ï¼Œæ¯ä¸ªæœåŠ¡å™¨éœ€è¦ä¸åŒçš„æŒ‡ä»¤ã€‚
ä»£ç†
æœåŠ¡å™¨ç”±ä¸»é¢˜çš„é¢†åŸŸå’Œå¯ç”¨äºç ”ç©¶æ‰€æä¾›ä¸»é¢˜çš„ç‰¹å®šæœåŠ¡å™¨åç§°ç¡®å®šã€‚ä»£ç†æŒ‰å…¶ä¸“ä¸šé¢†åŸŸåˆ†ç±»ï¼Œæ¯ç§æœåŠ¡å™¨ç±»å‹éƒ½ä¸ç›¸åº”çš„è¡¨æƒ…ç¬¦å·ç›¸å…³è”ã€‚

ä¾‹å­ï¼š
ä»»åŠ¡ï¼š"æˆ‘åº”è¯¥æŠ•èµ„è‹¹æœè‚¡ç¥¨å—ï¼Ÿ"
å›å¤ï¼š
{
    "server": "ğŸ’° é‡‘èä»£ç†",
    "agent_role_prompt: "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„é‡‘èåˆ†æå¸ˆAIåŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®æ ‡æ˜¯æ ¹æ®æä¾›çš„æ•°æ®å’Œè¶‹åŠ¿ï¼Œæ’°å†™å…¨é¢ã€æ•é”ã€å…¬æ­£ä¸”æœ‰æ¡ç†çš„é‡‘èæŠ¥å‘Šã€‚"
}
ä»»åŠ¡ï¼š"è½¬å”®è¿åŠ¨é‹èƒ½å¦ç›ˆåˆ©ï¼Ÿ"
å›å¤ï¼š
{ 
    "server":  "ğŸ“ˆ å•†ä¸šåˆ†æå¸ˆä»£ç†",
    "agent_role_prompt": "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„AIå•†ä¸šåˆ†æå¸ˆåŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®æ ‡æ˜¯æ ¹æ®æä¾›çš„å•†ä¸šæ•°æ®ã€å¸‚åœºè¶‹åŠ¿å’Œæˆ˜ç•¥åˆ†æï¼Œç”Ÿæˆå…¨é¢ã€æœ‰è§åœ°ã€å…¬æ­£ä¸”ç³»ç»Ÿç»“æ„åŒ–çš„å•†ä¸šæŠ¥å‘Šã€‚"
}
ä»»åŠ¡ï¼š"ç‰¹æ‹‰ç»´å¤«æœ€æœ‰è¶£çš„æ™¯ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"
å›å¤ï¼š
{
    "server":  "ğŸŒ æ—…æ¸¸ä»£ç†",
    "agent_role_prompt": "ä½ æ˜¯ä¸€ä½ç¯æ¸¸ä¸–ç•Œçš„AIå¯¼æ¸¸åŠ©æ‰‹ã€‚ä½ çš„ä¸»è¦ç›®çš„æ˜¯èµ·è‰æœ‰å…³ç»™å®šåœ°ç‚¹çš„å¼•äººå…¥èƒœã€æœ‰è§åœ°ã€å…¬æ­£ä¸”ç»“æ„è‰¯å¥½çš„æ—…è¡ŒæŠ¥å‘Šï¼ŒåŒ…æ‹¬å†å²ã€æ™¯ç‚¹å’Œæ–‡åŒ–è§è§£ã€‚"
}
"""


def generate_summary_prompt(query, data):
    """ä¸ºç»™å®šé—®é¢˜å’Œæ–‡æœ¬ç”Ÿæˆæ‘˜è¦æç¤ºã€‚
    å‚æ•°: question (str): è¦ç”Ÿæˆæ‘˜è¦æç¤ºçš„é—®é¢˜
            text (str): è¦ç”Ÿæˆæ‘˜è¦æç¤ºçš„æ–‡æœ¬
    è¿”å›: str: ç»™å®šé—®é¢˜å’Œæ–‡æœ¬çš„æ‘˜è¦æç¤º
    """

    return (
        f'{data}\n ä½¿ç”¨ä¸Šè¿°æ–‡æœ¬ï¼Œæ ¹æ®ä»¥ä¸‹ä»»åŠ¡æˆ–æŸ¥è¯¢å¯¹å…¶è¿›è¡Œæ€»ç»“ï¼š"{query}"ã€‚\n å¦‚æœ'
        f"æ— æ³•ä½¿ç”¨æ–‡æœ¬å›ç­”æŸ¥è¯¢ï¼Œä½ å¿…é¡»ç®€çŸ­åœ°æ€»ç»“æ–‡æœ¬ã€‚\n å¦‚æœæœ‰å¯ç”¨çš„ï¼ŒåŒ…æ‹¬æ‰€æœ‰äº‹å®"
        f"ä¿¡æ¯ï¼Œå¦‚æ•°å­—ã€ç»Ÿè®¡æ•°æ®ã€å¼•ç”¨ç­‰ã€‚"
    )


################################################################################################

# è¯¦ç»†æŠ¥å‘Šæç¤º


def generate_subtopics_prompt() -> str:
    return """
æä¾›ä¸»è¦ä¸»é¢˜ï¼š

{task}

å’Œç ”ç©¶æ•°æ®ï¼š

{data}

- æ„å»ºä¸€ä¸ªå­ä¸»é¢˜åˆ—è¡¨ï¼Œè¿™äº›å­ä¸»é¢˜å°†ä½œä¸ºè¦ç”Ÿæˆçš„å…³äºä»»åŠ¡çš„æŠ¥å‘Šæ–‡æ¡£çš„æ ‡é¢˜ã€‚
- è¿™äº›æ˜¯å¯èƒ½çš„å­ä¸»é¢˜åˆ—è¡¨ï¼š{subtopics}ã€‚
- ä¸åº”æœ‰ä»»ä½•é‡å¤çš„å­ä¸»é¢˜ã€‚
- å°†å­ä¸»é¢˜æ•°é‡é™åˆ¶ä¸ºæœ€å¤š{max_subtopics}ä¸ª
- æœ€åæŒ‰å…¶ä»»åŠ¡å¯¹å­ä¸»é¢˜è¿›è¡Œæ’åºï¼Œä»¥ç›¸å…³ä¸”æœ‰æ„ä¹‰çš„é¡ºåºï¼Œé€‚åˆåœ¨è¯¦ç»†æŠ¥å‘Šä¸­å‘ˆç°

"é‡è¦ï¼"ï¼š
- æ¯ä¸ªå­ä¸»é¢˜å¿…é¡»ä»…ä¸ä¸»è¦ä¸»é¢˜å’Œæä¾›çš„ç ”ç©¶æ•°æ®ç›¸å…³ï¼

{format_instructions}
"""


def generate_subtopic_report_prompt(
    current_subtopic,
    existing_headers: list,
    relevant_written_contents: list,
    main_topic: str,
    context,
    report_format: str = "apa",
    max_subsections=5,
    total_words=800,
    tone: Tone = Tone.Objective,
    language: str = "english",
) -> str:
    return f"""
ä¸Šä¸‹æ–‡ï¼š
"{context}"

ä¸»é¢˜å’Œå­ä¸»é¢˜ï¼š
ä½¿ç”¨æœ€æ–°å¯ç”¨ä¿¡æ¯ï¼Œåœ¨ä¸»é¢˜ï¼š{main_topic}ä¸‹æ„å»ºå…³äºå­ä¸»é¢˜ï¼š{current_subtopic}çš„è¯¦ç»†æŠ¥å‘Šã€‚
ä½ å¿…é¡»å°†å­éƒ¨åˆ†æ•°é‡é™åˆ¶ä¸ºæœ€å¤š{max_subsections}ä¸ªã€‚

å†…å®¹é‡ç‚¹ï¼š
- æŠ¥å‘Šåº”ä¸“æ³¨äºå›ç­”é—®é¢˜ï¼Œç»“æ„è‰¯å¥½ï¼Œä¿¡æ¯ä¸°å¯Œï¼Œæ·±å…¥ï¼Œå¹¶åŒ…æ‹¬äº‹å®å’Œæ•°å­—ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
- ä½¿ç”¨markdownè¯­æ³•å¹¶éµå¾ª{report_format.upper()}æ ¼å¼ã€‚

é‡è¦ï¼šå†…å®¹å’Œéƒ¨åˆ†çš„å”¯ä¸€æ€§ï¼š
- è¿™éƒ¨åˆ†æŒ‡ä»¤å¯¹ç¡®ä¿å†…å®¹å”¯ä¸€ä¸”ä¸ä¸ç°æœ‰æŠ¥å‘Šé‡å è‡³å…³é‡è¦ã€‚
- åœ¨æ’°å†™ä»»ä½•æ–°çš„å­éƒ¨åˆ†ä¹‹å‰ï¼Œè¯·ä»”ç»†å®¡æŸ¥ä¸‹é¢æä¾›çš„ç°æœ‰æ ‡é¢˜å’Œç°æœ‰ä¹¦é¢å†…å®¹ã€‚
- é˜²æ­¢ä»»ä½•å·²åœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–çš„å†…å®¹ã€‚
- ä¸è¦ä½¿ç”¨ä»»ä½•ç°æœ‰æ ‡é¢˜ä½œä¸ºæ–°çš„å­éƒ¨åˆ†æ ‡é¢˜ã€‚
- ä¸è¦é‡å¤å·²åœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–çš„ä»»ä½•ä¿¡æ¯æˆ–å¯†åˆ‡ç›¸å…³çš„å˜ä½“ï¼Œä»¥é¿å…é‡å¤ã€‚
- å¦‚æœä½ æœ‰åµŒå¥—çš„å­éƒ¨åˆ†ï¼Œç¡®ä¿å®ƒä»¬æ˜¯å”¯ä¸€çš„ï¼Œä¸”æœªåœ¨ç°æœ‰ä¹¦é¢å†…å®¹ä¸­æ¶µç›–ã€‚
- ç¡®ä¿ä½ çš„å†…å®¹å®Œå…¨æ˜¯æ–°çš„ï¼Œä¸ä¸å…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šä¸­å·²æ¶µç›–çš„ä»»ä½•ä¿¡æ¯é‡å ã€‚

"ç°æœ‰å­ä¸»é¢˜æŠ¥å‘Š"ï¼š
- ç°æœ‰å­ä¸»é¢˜æŠ¥å‘ŠåŠå…¶éƒ¨åˆ†æ ‡é¢˜ï¼š

    {existing_headers}

- æ¥è‡ªå…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šçš„ç°æœ‰ä¹¦é¢å†…å®¹ï¼š

    {relevant_written_contents}

"ç»“æ„å’Œæ ¼å¼"ï¼š
- ç”±äºè¿™ä¸ªå­æŠ¥å‘Šå°†æ˜¯æ›´å¤§æŠ¥å‘Šçš„ä¸€éƒ¨åˆ†ï¼ŒåªåŒ…æ‹¬åˆ†ä¸ºé€‚å½“å­ä¸»é¢˜çš„ä¸»ä½“éƒ¨åˆ†ï¼Œä¸åŒ…æ‹¬ä»»ä½•ä»‹ç»æˆ–ç»“è®ºéƒ¨åˆ†ã€‚

- ä½ å¿…é¡»åœ¨æŠ¥å‘Šä¸­å¼•ç”¨ç›¸å…³URLçš„åœ°æ–¹åŒ…å«markdownè¶…é“¾æ¥ï¼Œä¾‹å¦‚ï¼š

    ### éƒ¨åˆ†æ ‡é¢˜
    
    è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ–‡æœ¬ã€‚([ç½‘ç«™URL](url))

- ä½¿ç”¨H2ä½œä¸ºä¸»è¦å­ä¸»é¢˜æ ‡é¢˜ï¼ˆ##ï¼‰å’ŒH3ä½œä¸ºå­éƒ¨åˆ†ï¼ˆ###ï¼‰ã€‚
- ä½¿ç”¨è¾ƒå°çš„Markdownæ ‡é¢˜ï¼ˆä¾‹å¦‚ï¼ŒH2æˆ–H3ï¼‰è¿›è¡Œå†…å®¹ç»“æ„ï¼Œé¿å…ä½¿ç”¨æœ€å¤§çš„æ ‡é¢˜ï¼ˆH1ï¼‰ï¼Œå› ä¸ºå®ƒå°†ç”¨äºæ›´å¤§æŠ¥å‘Šçš„æ ‡é¢˜ã€‚
- å°†ä½ çš„å†…å®¹ç»„ç»‡æˆä¸åŒçš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†è¡¥å……ä½†ä¸ä¸ç°æœ‰æŠ¥å‘Šé‡å ã€‚
- å½“å‘ä½ çš„æŠ¥å‘Šæ·»åŠ ç±»ä¼¼æˆ–ç›¸åŒçš„å­éƒ¨åˆ†æ—¶ï¼Œä½ åº”è¯¥æ¸…æ¥šåœ°æŒ‡å‡ºæ–°å†…å®¹ä¸æ¥è‡ªå…ˆå‰å­ä¸»é¢˜æŠ¥å‘Šçš„ç°æœ‰ä¹¦é¢å†…å®¹ä¹‹é—´çš„å·®å¼‚ã€‚ä¾‹å¦‚ï¼š

    ### æ–°æ ‡é¢˜ï¼ˆç±»ä¼¼äºç°æœ‰æ ‡é¢˜ï¼‰

    è™½ç„¶å‰ä¸€éƒ¨åˆ†è®¨è®ºäº†[ä¸»é¢˜A]ï¼Œä½†æœ¬éƒ¨åˆ†å°†æ¢è®¨[ä¸»é¢˜B]ã€‚"

"æ—¥æœŸ"ï¼š
å¦‚æœéœ€è¦ï¼Œå‡è®¾å½“å‰æ—¥æœŸæ˜¯{datetime.now(timezone.utc).strftime('%B %d, %Y')}ã€‚

"é‡è¦ï¼"ï¼š
- ä½ å¿…é¡»ç”¨ä»¥ä¸‹è¯­è¨€æ’°å†™æŠ¥å‘Šï¼š{language}ã€‚
- é‡ç‚¹å¿…é¡»æ”¾åœ¨ä¸»é¢˜ä¸Šï¼ä½ å¿…é¡»çœç•¥ä»»ä½•ä¸ä¹‹æ— å…³çš„ä¿¡æ¯ï¼
- ä¸å¾—æœ‰ä»»ä½•ä»‹ç»ã€ç»“è®ºã€æ‘˜è¦æˆ–å‚è€ƒéƒ¨åˆ†ã€‚
- ä½ å¿…é¡»åœ¨å¿…è¦çš„åœ°æ–¹ä½¿ç”¨markdownè¯­æ³•ï¼ˆ[ç½‘ç«™URL](url)ï¼‰åŒ…å«ä¸å¥å­ç›¸å…³çš„è¶…é“¾æ¥ã€‚
- å¦‚æœä½ æ·»åŠ ç±»ä¼¼æˆ–ç›¸åŒçš„å­éƒ¨åˆ†ï¼Œä½ å¿…é¡»åœ¨å¿…è¦çš„åœ°æ–¹åœ¨æŠ¥å‘Šä¸­æåŠç°æœ‰å†…å®¹å’Œæ–°å†…å®¹ä¹‹é—´çš„å·®å¼‚ã€‚
- æŠ¥å‘Šåº”è‡³å°‘æœ‰{total_words}ä¸ªå­—ã€‚
- åœ¨æ•´ä¸ªæŠ¥å‘Šä¸­ä½¿ç”¨{tone.value}çš„è¯­æ°”ã€‚

ä¸è¦æ·»åŠ ç»“è®ºéƒ¨åˆ†ã€‚
"""


def generate_draft_titles_prompt(
    current_subtopic: str,
    main_topic: str,
    context: str,
    max_subsections: int = 5
) -> str:
    return f"""
"ä¸Šä¸‹æ–‡"ï¼š
"{context}"

"ä¸»é¢˜å’Œå­ä¸»é¢˜"ï¼š
ä½¿ç”¨æœ€æ–°å¯ç”¨ä¿¡æ¯ï¼Œä¸ºä¸»é¢˜ï¼š{main_topic}ä¸‹çš„å­ä¸»é¢˜ï¼š{current_subtopic}æ„å»ºè¯¦ç»†æŠ¥å‘Šçš„è‰ç¨¿éƒ¨åˆ†æ ‡é¢˜ã€‚

"ä»»åŠ¡"ï¼š
1. ä¸ºå­ä¸»é¢˜æŠ¥å‘Šåˆ›å»ºè‰ç¨¿éƒ¨åˆ†æ ‡é¢˜åˆ—è¡¨ã€‚
2. æ¯ä¸ªæ ‡é¢˜åº”ç®€æ´ä¸”ä¸å­ä¸»é¢˜ç›¸å…³ã€‚
3. æ ‡é¢˜ä¸åº”å¤ªé«˜çº§ï¼Œä½†åº”è¶³å¤Ÿè¯¦ç»†ä»¥æ¶µç›–å­ä¸»é¢˜çš„ä¸»è¦æ–¹é¢ã€‚
4. ä½¿ç”¨markdownè¯­æ³•ä¸ºæ ‡é¢˜ï¼Œä½¿ç”¨H3ï¼ˆ###ï¼‰ï¼Œå› ä¸ºH1å’ŒH2å°†ç”¨äºæ›´å¤§æŠ¥å‘Šçš„æ ‡é¢˜ã€‚
5. ç¡®ä¿æ ‡é¢˜æ¶µç›–å­ä¸»é¢˜çš„ä¸»è¦æ–¹é¢ã€‚

"ç»“æ„å’Œæ ¼å¼"ï¼š
ä½¿ç”¨markdownè¯­æ³•ä»¥åˆ—è¡¨æ ¼å¼æä¾›è‰ç¨¿æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼š

### æ ‡é¢˜1
### æ ‡é¢˜2
### æ ‡é¢˜3

"é‡è¦ï¼"ï¼š
- é‡ç‚¹å¿…é¡»æ”¾åœ¨ä¸»é¢˜ä¸Šï¼ä½ å¿…é¡»çœç•¥ä»»ä½•ä¸ä¹‹æ— å…³çš„ä¿¡æ¯ï¼
- ä¸å¾—æœ‰ä»»ä½•ä»‹ç»ã€ç»“è®ºã€æ‘˜è¦æˆ–å‚è€ƒéƒ¨åˆ†ã€‚
- ä»…ä¸“æ³¨äºåˆ›å»ºæ ‡é¢˜ï¼Œè€Œéå†…å®¹ã€‚
"""


def generate_report_introduction(question: str, research_summary: str = "", language: str = "english") -> str:
    return f"""{research_summary}\n 
ä½¿ç”¨ä¸Šè¿°æœ€æ–°ä¿¡æ¯ï¼Œå‡†å¤‡ä¸€ä»½å…³äºä¸»é¢˜çš„è¯¦ç»†æŠ¥å‘Šä»‹ç» -- {question}ã€‚
- ä»‹ç»åº”ç®€æ´ã€ç»“æ„è‰¯å¥½ã€ä¿¡æ¯ä¸°å¯Œï¼Œä½¿ç”¨markdownè¯­æ³•ã€‚
- ç”±äºè¿™ä¸ªä»‹ç»å°†æ˜¯æ›´å¤§æŠ¥å‘Šçš„ä¸€éƒ¨åˆ†ï¼Œä¸è¦åŒ…æ‹¬é€šå¸¸å­˜åœ¨äºæŠ¥å‘Šä¸­çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ã€‚
- ä»‹ç»å‰åº”æœ‰ä¸€ä¸ªå¸¦æœ‰æ•´ä¸ªæŠ¥å‘Šé€‚å½“ä¸»é¢˜çš„H1æ ‡é¢˜ã€‚
- ä½ å¿…é¡»åœ¨å¿…è¦çš„åœ°æ–¹ä½¿ç”¨markdownè¯­æ³•ï¼ˆ[ç½‘ç«™URL](url)ï¼‰åŒ…å«ä¸å¥å­ç›¸å…³çš„è¶…é“¾æ¥ã€‚
å¦‚æœéœ€è¦ï¼Œå‡è®¾å½“å‰æ—¥æœŸæ˜¯{datetime.now(timezone.utc).strftime('%B %d, %Y')}ã€‚
- è¾“å‡ºå¿…é¡»ä½¿ç”¨{language}è¯­è¨€ã€‚
"""


def generate_report_conclusion(query: str, report_content: str, language: str = "english") -> str:
    """
    ç”Ÿæˆä¸€ä¸ªç®€æ´çš„ç»“è®ºï¼Œæ€»ç»“ç ”ç©¶æŠ¥å‘Šçš„ä¸»è¦å‘ç°å’Œå«ä¹‰ã€‚

    å‚æ•°:
        query (str): ç ”ç©¶ä»»åŠ¡æˆ–é—®é¢˜ã€‚
        report_content (str): ç ”ç©¶æŠ¥å‘Šçš„å†…å®¹ã€‚
        language (str): ç»“è®ºåº”ä½¿ç”¨çš„è¯­è¨€ã€‚

    è¿”å›:
        str: ä¸€ä¸ªç®€æ´çš„ç»“è®ºï¼Œæ€»ç»“æŠ¥å‘Šçš„ä¸»è¦å‘ç°å’Œå«ä¹‰ã€‚
    """
    prompt = f"""
    åŸºäºä»¥ä¸‹ç ”ç©¶æŠ¥å‘Šå’Œç ”ç©¶ä»»åŠ¡ï¼Œè¯·å†™ä¸€ä¸ªç®€æ´çš„ç»“è®ºï¼Œæ€»ç»“ä¸»è¦å‘ç°åŠå…¶å«ä¹‰ï¼š
    
    ç ”ç©¶ä»»åŠ¡: {query}
    
    ç ”ç©¶æŠ¥å‘Š: {report_content}

    ä½ çš„ç»“è®ºåº”è¯¥:
    1. å›é¡¾ç ”ç©¶çš„ä¸»è¦ç‚¹
    2. çªå‡ºæœ€é‡è¦çš„å‘ç°
    3. è®¨è®ºä»»ä½•å«ä¹‰æˆ–ä¸‹ä¸€æ­¥
    4. é•¿åº¦çº¦ä¸º2-3æ®µ

    å¦‚æœæŠ¥å‘Šæœ«å°¾æ²¡æœ‰å†™"## ç»“è®º"éƒ¨åˆ†æ ‡é¢˜ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°ä½ çš„ç»“è®ºé¡¶éƒ¨ã€‚
    ä½ å¿…é¡»åœ¨å¿…è¦çš„åœ°æ–¹ä½¿ç”¨markdownè¯­æ³•ï¼ˆ[ç½‘ç«™URL](url)ï¼‰åŒ…å«ä¸å¥å­ç›¸å…³çš„è¶…é“¾æ¥ã€‚

    é‡è¦ï¼šæ•´ä¸ªç»“è®ºå¿…é¡»ç”¨{language}è¯­è¨€æ’°å†™ã€‚

    å†™ç»“è®ºï¼š
    """

    return prompt


report_type_mapping = {
    ReportType.ResearchReport.value: generate_report_prompt,
    ReportType.ResourceReport.value: generate_resource_report_prompt,
    ReportType.OutlineReport.value: generate_outline_report_prompt,
    ReportType.CustomReport.value: generate_custom_report_prompt,
    ReportType.SubtopicReport.value: generate_subtopic_report_prompt,
    ReportType.DeepResearch.value: generate_deep_research_prompt,
}


def get_prompt_by_report_type(report_type):
    prompt_by_type = report_type_mapping.get(report_type)
    default_report_type = ReportType.ResearchReport.value
    if not prompt_by_type:
        warnings.warn(
            f"æ— æ•ˆçš„æŠ¥å‘Šç±»å‹: {report_type}ã€‚\n"
            f"è¯·ä½¿ç”¨ä»¥ä¸‹ä¹‹ä¸€: {', '.join([enum_value for enum_value in report_type_mapping.keys()])}\n"
            f"ä½¿ç”¨é»˜è®¤æŠ¥å‘Šç±»å‹: {default_report_type} æç¤ºã€‚",
            UserWarning,
        )
        prompt_by_type = report_type_mapping.get(default_report_type)
    return prompt_by_type
